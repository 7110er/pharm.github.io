<!DOCTYPE html>
<html lang="zh-TW">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="高順鴻">
        <title>衛教專區</title>
        <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"> -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css">
        <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script> -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">       
        <style>
            body {
                font-family: Arial, Helvetica, sans-serif;
                margin: 0;
            }
            .homeBar {
                width: 100%;
                position: fixed;
                color: white;
                background-color: #012061;
                float: left;
                overflow: auto;
                display: block;

            }
            .homeBar a {
                color: white;
                font-size: 20px;
                float: left;
                display: block;
                padding: 10px   ;
            }
            .homeBar a:hover{
                background-color: #000;
            }
            .center {
                display: block;
                margin-left: auto;
                margin-right: auto;
                width: 100%;
            }
            .navbar {
                height: 100%;
                width: 0;
                position: fixed;
                z-index: 1;
                top: 0;
                right: 0;
                background-color: #111;
                overflow-x: hidden;
                transition: 0.5s;
                padding-top: 60px;
            }
            .navbar .closebtn {
                position: absolute;
                top: 0;
                right: 25px;
                font-size: 36px;
                margin-left: 50px;
            }
            .navbar a {
                padding: 8px 8px 8px 32px;
                text-decoration: none;
                font-size: 12px;
                color: #818181;
                display: block;
                transition: 0.3s;
            }

            .subnav {
                overflow: hidden;
            }
            .subnav .subnavbtn {
                font-size: 16px;  
                border: none;
                outline: none;
                color: white;
                padding: 14px 5px;
                background-color: inherit;
                font-family: inherit;
                text-align: center;

            }
            .subnav-content {
                display: none;
                position: relative;
                background-color: rgb(192, 211, 252);
                z-index: 1;
                text-align: center;
            }
            .subnav-content a {
                display: block;
                color: rgb(0, 0, 0);
                text-decoration: none;
            }
            .subnav-content a:hover {
                background-color: #eee;
                color: black;
            }
            .change {
                display: block;
            }
            /* @media screen and (max-height: 450px) {
                .sidenav {padding-top: 15px;}
                .sidenav a {font-size: 18px;}
            }         */
        </style>
        <script >
            function reLoad() {
                google.script.run
                .withSuccessHandler(function(url){
                    window.open(url,'_top');
                })
                .getScriptURL();
                console.log("reload");
            }            
            function openNav() {
                document.getElementById("navbar").style.width = "25%";
                document.getElementById("homeBar").style.marginRight = "25%";
                document.getElementById("result").style.marginRight = "25%";
                console.log('231');
            }

            function closeNav() {
                document.getElementById("navbar").style.width = "0";
                document.getElementById("homeBar").style.marginRight = "0";
                document.getElementById("result").style.marginRight = "0";
            }            
            function searchMenu(divElement){
                closeNav();
                searchGoogleSheet(divElement);
            }

            function change(element){
                element.nextElementSibling.classList.toggle('change');
            }

            function searchGoogleSheet(divElement){
                var searchText = $(divElement).text();
                google.script.run.withSuccessHandler(createTable).search(searchText);
                console.log('123');
            }
            function createTable(dataArray) {
            if (dataArray && dataArray !== undefined && dataArray.length != 0) {

                var result1 = "<table class='table table-sm table-striped' id='dtable' style='font-size:16px'>" +
                    "<thead style='white-space: normal'>" +

                    "<tr>" 
                    for (var i = 0; i < dataArray.length; i++) {
                        for (var j = 0; j < 1; j++) {
                            if(dataArray[i][j]==''){
                                result1+='';
                            }
                            else{
                                result1 +="<th scope='col' style='width:90px' >中文名</th>"+"<td >" + dataArray[i][j] + "</td>";
                            }
                    }
                }
                    result1+=
                    "</tr>" + 
                    "<tr>" + 
                    "<th scope='col' style='width:90px '>英文名</th>" 
                    for (var i = 0; i < dataArray.length; i++) {
                        for (var j = 1; j < 2; j++) {
                        result1 += "<td>" + dataArray[i][j] + "</td>";
                    }
                }
                    result1+=
                    "</tr>" + 
                    "<tr>" + 
                    "<th scope='col'style='width:90px'>主成分</th>" 
                    for (var i = 0; i < dataArray.length; i++) {
                        for (var j = 2; j < 3; j++) {
                        result1 += "<td>" + dataArray[i][j] + "</td>";
                    }
                }
                    result1+=
                    "</tr>" + 
                    "<tr>" 
                    for (var i = 0; i < dataArray.length; i++) {
                        for (var j = 3; j < 4; j++) {
                            if(dataArray[i][j]==''){
                                result1+='';
                            }
                            else{
                                result1 +="<th scope='col' style='width:90px' >適應症</th>"+"<td >" +  dataArray[i][j] + "</td>";
                            }
                    }
                }
                    result1+=
                    "</tr>" +
                    "<tr>"
                    for (var i = 0; i < dataArray.length; i++) {
                        for (var j = 4; j < 5; j++) {
                            if (isURL(dataArray[i][j])){
                                result1 += "<td colspan='2'  ><img src='"+ dataArray[i][j] + "'  style='width:100%'></td>"
                            }
                            else{
                                result1 += "";
                            }
                    }
                }
                    result1+=
                    "</tr>"+
                    "<tr>"
                    for (var i = 0; i < dataArray.length; i++) {
                        for (var j = 5 ;j < 6; j++) {
                            if (isURL(dataArray[i][j])){
                            result1 += "<td colspan='2'  ><img src='"+ dataArray[i][j] + "'  style='width:100%'></td>"
                        }
                        else{
                            result1 += "";
                        }
                    }
                }
                    result1+=
                    "</tr>"+
                    "<tr>"
                    for (var i = 0; i < dataArray.length; i++) {
                        for (var j = 6 ;j < 7; j++) {
                            if (isURL(dataArray[i][j])){
                            result1 += "<td colspan='2'  ><img src='"+ dataArray[i][j] + "'  style='width:100%'></td>"
                        }
                        else{
                            result1 += "";
                        }
                    }
                }
                    result1+=
                    "</tr>"+

                    "</thead>"+
                    "</table>";
                
                

                var div = document.getElementById('result');
                div.innerHTML = result1;
                
            } 

            else {

                var div = document.getElementById('result');
                div.innerHTML = "沒有找到相關藥物，請重新輸入。";
            }
        }
                // 判斷string 是否為網址
            function isURL(string) {
                let url;
                
                try {
                    url = new URL(string);
                } catch (_) {
                    return false;  
                }

                return url.protocol === "http:" || url.protocol === "https:";
            }

        </script>
    </head>      

    <body >

        <div class="homeBar" id="homeBar">
            <a href="#"><i class="fa fa-home" onclick="reLoad()"> 首頁</i></a>
            <a href="#"><i class="fa fa-envelope"> 聯絡我們</i></a>            
            <a href="javascript:void(0);" class="icon" onclick="openNav()" ><i class="fa fa-bars"> 疾病專區</i></a>
        </div>
        <div class="navbar" id="navbar">
            <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
            <div class="subnav">
              <button class="subnavbtn" onclick="change(this)">心血管內科 <i class="fa fa-caret-down"></i></button>
              <div class="subnav-content">
                <a href="#" onclick="searchMenu(this);">高血壓</a>
                <a href="#" onclick="searchMenu(this);">心衰竭</a>
                <a href="#" onclick="searchMenu(this);">冠心症</a>
                <a href="#" onclick="searchMenu(this);">心律不整</a>

            </div>
            </div> 
            <div class="subnav">
              <button class="subnavbtn" onclick="change(this)">內分泌科 <i class="fa fa-caret-down"></i></button>
              <div class="subnav-content">
                <a href="#" onclick="searchMenu(this);">糖尿病</a>
                <a href="#" onclick="searchMenu(this);">甲狀腺疾病</a>
                <a href="#" onclick="searchMenu(this);">代謝症候群</a>
              </div>
            </div> 
            <div class="subnav">
              <button class="subnavbtn" onclick="change(this)">神經科 <i class="fa fa-caret-down"></i></button>
              <div class="subnav-content">
                <a href="#" onclick="searchMenu(this);">中風</a>
                <a href="#" onclick="searchMenu(this);">失智症</a>
                <a href="#" onclick="searchMenu(this);">帕金森氏症</a>
              </div>
            </div>
            <div class="subnav">
                <button class="subnavbtn" onclick="change(this)">腎臟科 <i class="fa fa-caret-down"></i></button>
                <div class="subnav-content">
                  <a href="#" onclick="searchMenu(this);">慢性腎臟病</a>
                  <a href="#" onclick="searchMenu(this);">貧血</a>
                  <a href="#" onclick="searchMenu(this);">血液透析</a>
                </div>
              </div>
              <div class="subnav">
                <button class="subnavbtn" onclick="change(this)">胸腔科 <i class="fa fa-caret-down"></i></button>
                <div class="subnav-content">
                  <a href="#" onclick="searchMenu(this);">氣喘</a>
                  <a href="#" onclick="searchMenu(this);">慢性阻塞性肺病</a>
                </div>
              </div>
              <div class="subnav">
                <button class="subnavbtn" onclick="change(this)">肝膽腸胃科 <i class="fa fa-caret-down"></i></button>
                <div class="subnav-content">
                  <a href="#" onclick="searchMenu(this);">慢性肝炎</a>
                  <a href="#" onclick="searchMenu(this);">胃食道逆流</a>
                  <a href="#" onclick="searchMenu(this);">消化性潰瘍</a>
                </div>
              </div>
              <div class="subnav">
                <button class="subnavbtn" onclick="change(this)">風濕免疫科 <i class="fa fa-caret-down"></i></button>
                <div class="subnav-content">
                  <a href="#" onclick="searchMenu(this);">痛風</a>
                  <a href="#" onclick="searchMenu(this);">類風溼關節炎</a>
                  <a href="#" onclick="searchMenu(this);">紅斑性狼瘡</a>
                </div>
              </div>
              <div class="subnav">
                <button class="subnavbtn" onclick="change(this)">感染科 <i class="fa fa-caret-down"></i></button>
                <div class="subnav-content">
                  <a href="#" onclick="searchMenu(this);">愛滋病</a>
                  <a href="#" onclick="searchMenu(this);">肺結核</a>
                  <a href="#" onclick="searchMenu(this);">疫苗相關</a>
                </div>
              </div>
        </div>
        <div>
        
            <div id="result"  style="padding-top:10% ;">
            <a  href="#" ><img class="center" src="https://i.imgur.com/02LIyeR.jpeg" ></a>
            </div>
        </div>
        
    </body>
</html>