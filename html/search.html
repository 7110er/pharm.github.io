

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>藥品查詢</title>

    <!-- 連結Bootstrap -->

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>


    <script>
        //  避免表單有空白的錯誤

        function preventFormSubmit() {
            var forms = document.querySelectorAll('form');
            for (var i = 0; i < forms.length; i++) {
                forms[i].addEventListener('submit', function(event) {
                    event.preventDefault();
                });
            }

        }
        window.addEventListener("load", preventFormSubmit, true);

        // 顯示表格內容

        function createTable(dataArray) {
            if (dataArray && dataArray !== undefined && dataArray.length != 0) {

                var result1 = "<table class='table table-sm table-striped' id='dtable' style='font-size:30px'>" +
                    "<thead style='white-space: nowrap'>" +
                    "<tr>" + 
                    "<th scope='col'>處置代碼</th>" +
                    "<th scope='col'>商品名</th>" +
                    "<th scope='col'>TradeNameB5</th>" +
                    "<th scope='col'>Formulary</th>" +
                    "<th scope='col'>NHICode</th>" +
                    "<th scope='col'>Indication</th>" +


                    "</tr>" +
                    "</thead>";
                for (var i = 0; i < dataArray.length; i++) {
                    result1 += "<tr>";
                    for (var j = 0; j < dataArray[i].length; j++) {

                        if (isURL(dataArray[i][j])){
                            result1 += "<td><img src='" + dataArray[i][j] + "' ></td>"
                        }
                        else{
                            result1 += "<td>" + dataArray[i][j] + "</td>";
                        }
                        
                    }
                    result1 += "</tr>";
                }
                result1 += "</table>";
                var div = document.getElementById('search-results');
                div.innerHTML = result1;


            } 
            else {

                var div = document.getElementById('search-results');
                div.innerHTML = "沒有找到相關藥物，請重新輸入。";
            }
        }
        // 判斷string 是否為網址
        function isURL(string) {
            let url;
            
            try {
                url = new URL(string);
            } catch (_) {
                return false;  
            }

            return url.protocol === "http:" || url.protocol === "https:";
        }

        // 連結Google Script　並且顯示資料

        function handleFormSubmit(formObject) {
            google.script.run.withSuccessHandler(createTable).submitForm(formObject);
            document.getElementById("search-form").reset();
        }
        function erase(){
            document.getElementById("erase").innerHTML='清除';
        }
</script>
    <style>
        #date {position: absolute; top: 1%;right: 30px;}
        #copyright {position:absolute ;top: 4%;right: 30px;}

    </style>

</head>

<body>

    <br>
    <br>
    <h2 style="text-align: center;"><b>藥品查詢</b></h2>
    <br>
    <!--搜尋表單  -->

    <div class="container">

        <div class="row">


            <form id="search-form" class="form-inline" onsubmit="handleFormSubmit(this)">

                <input style="width:60%;" type="text" id="searchtext" name="searchtext" placeholder="請輸入藥品名稱">

                <button type="submit" class="btn btn-primary">搜尋</button>
                <button onclick="javascript: parent.location.replace(location.href)" class="btn btn-primary">清除</button>

            </form>


        </div>

        <!-- 表格要顯示的地方 -->
        <div class="row">

            <div id="search-results" class="table-reponsive">


            </div>

        </div>


    </div>
    <hr>
    <p id="pic"></p>
    <p id="erase"></p>
    <p id="date"></p>
    <p id="copyright"></p>
    <script>
        document.getElementById('date').innerHTML=new Date();
        document.getElementById('copyright').innerHTML='Copyright © ryan10812@gmail.com';
    </script>


</body>

</html>



