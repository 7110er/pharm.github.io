<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>藥師教學歷程</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3pro.css">
    <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-teal.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- 連結jquery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- 連結jquery moblie -->
    <link rel="stylesheet" href="https://apps.bdimg.com/libs/jquerymobile/1.4.5/jquery.mobile-1.4.5.min.css">
    <script src="https://apps.bdimg.com/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="https://apps.bdimg.com/libs/jquerymobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <!-- 連結Data table -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.css">
    <link rel="https://cdn.datatables.net/fixedcolumns/4.0.1/css/fixedColumns.dataTables.min.css">
    <script type="text/javascript" charset="utf8"
        src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.js"></script>
    <script src="https://cdn.datatables.net/fixedcolumns/4.0.1/js/dataTables.fixedColumns.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>

    <style>
        .page {
            display: none;
        }

        .active {
            background-color: #eee !important;
            color: black !important;
        }

        .width-60 {
            width: 120px;
        }

        .title {
            background-color: #009688;
            color: white;
            /* width: fit-content; */
        }

        .title1 {
            background-color: #EFEFEF;
            color: black;
            font-weight: bold;
            /* width: fit-content; */
        }
    </style>
    <script>
        $(document).ready(function () {
            google.script.run.withSuccessHandler(sheetName).getName();
            function sheetName(dataArray) {
                for (var i = 0; i < 20; i++) {
                    $('#' + 'page' + i).html(dataArray[i])
                }
            }

            google.script.run.withSuccessHandler(showData).getData();
            function showData(dataArray) {
                for (var i = 0; i < 8; i++) {// 有幾個工作表i就要小於多少
                    $('#' + 'data-table_' + i).DataTable({
                        scrollX: true,
                        scrollY: 800,
                        scrollCollapse: true,
                        data: dataArray[i],
                        columns: [
                            { "title": dataArray[i][0][0] },
                            { "title": dataArray[i][0][1] },
                            { "title": dataArray[i][0][2] },
                        ],
                        "language": {
                                   URL:"zh.Hant.json"             }                        ,
                        columnDefs: [
                            {
                                render: function (data, type, full, meta) {
                                    return "<div class='width-60'>" + data + "</div>";
                                },
                                targets: 1
                            },
                        ],

                    });
                    var table = $('#' + 'data-table_' + i)
                    $(table).DataTable().columns.adjust().draw();
                    $(table).addClass('display wrap compact table-hover table-striped');
                    $(table).DataTable().row(table.children(2).children(1)).remove().draw();

                };
            }


            $('.btn').click(function () {
                var check = $(this).hasClass('active');
                var then = "_" + this.id
                if (!check) {
                    $(this).toggleClass('active');
                    $('.homeBar a').not(this).removeClass('active');
                    $('#' + then).toggle();
                    $('table').DataTable().columns.adjust().draw();
                    $(".page:visible").not('#' + then).hide();
                };
                $('#title').html(this.textContent);
                closeSidebar();
            });
            closeSidebar();
        })
        function getVal(data) {
            var text = $(data).parent().next().text()
            var index = $(data).closest('table').attr('id')  // 取得所在table的id名稱ex:data-table_1
            var e = parseInt(index.slice(11))
            // 宣告變數e將data-table_1轉為1(數字)，當google script上searchData的第二個參數，
            // 讓他可以搜尋按鈕所在的工作表位置，否則所有按鈕都執行getVal這function卻不知道要去哪個工作表內找資料
            google.script.run.withSuccessHandler(showData_2).searchData(text, e);
        }
        function getVal1(data) {
            var text = $(data).parent().next().text()
            google.script.run.withSuccessHandler(showData_2).searchData1(text);
        }

        function showData_2(array) {
            if (array !== undefined && array.length != 0) {
                var dataResult = "<table class='table table-sm table-striped' width='100%' style='table-layout:fixed'>" +
                    "<thead style='white-space: normal'>"
                for (var i = 0; i < 1; i++) {
                    for (var j = 0; j < array[i].length - 1; j++) {
                        if (array[i + 1][j + 1] != undefined && array[i + 1][j + 1] !== "") {
                            dataResult += "<tr>" + "<td class = 'title'>" + array[i][j] + "</td>" + "<td>" + array[i + 1][j + 1] + "</td>" + "</tr>"
                        }
                    }
                }
                dataResult += "</thead>" + "</table>"

                $('#content').html(dataResult)
            }
        }

        function openSidebar() {
            document.getElementById("Sidebar").style.display = "block";
        }

        function closeSidebar() {
            document.getElementById("Sidebar").style.display = "none";
        }

        $(document).ready(function () {
            $('#bookdate').change(function () {//日期選擇自動填入試算表
                var date = document.getElementById('bookdate');
                var rowData = date.value;
                google.script.run.addDate(rowData);
                google.script.run.withSuccessHandler(Showdata_1).getData1();//創造表格
                function Showdata_1(dataArray) {
                    if (dataArray !== undefined && dataArray.length != 0) {
                        var dataResult = "<table class='table table-sm table-striped' width='100%' data-dismissible='false' >" +
                            "<thead style='white-space: nowrap'>"
                        for (var i = 0; i < 1; i++) {
                            for (var j = 0; j < 1; j++) {
                                dataResult += "<tr class='title'>" + "<td>" + dataArray[i][j] + "</td>"
                            }
                            for (var j = 1; j < 16; j++) {
                                dataResult += "<td>" + dataArray[i][j] + "</td>"
                            }
                            for (var j = 16; j < 17; j++) {
                                dataResult += "<td>" + dataArray[i][j] + "</td>" + "</tr>"
                            }
                        }
                        for (var i = 1; i < 14; i++) {
                            for (var j = 0; j < 1; j++) {
                                dataResult += "<tr>" + "<td class='title1'>" + dataArray[i][j] + "</td>"
                            }
                            for (var j = 1; j < 16; j++) {
                                dataResult += "<td>" + dataArray[i][j] + "</td>"
                            }
                            for (var j = 16; j < 17; j++) {
                                dataResult += "<td>" + dataArray[i][j] + "</td>" + "</tr>"
                            }
                        }
                        dataResult += "</thead>" + "</table>"

                        $('#timetable').html(dataResult)

                    }
                }
            })
        })

        $(document).ready(function () {
            google.script.run.withSuccessHandler(showData_3).getData2();
            function showData_3(dataArray) {
                if (dataArray !== undefined && dataArray.length != 0) {
                    var dataResult = '<select name="PGY_value" id="PGY_value">'
                    for (var i = 0; i < 1; i++) {
                        for (var j = 0; j < dataArray[i].length; j++) {
                            if (dataArray[i][j] !== undefined && dataArray[i][j] !== '') {
                                dataResult += '<option value=' + "'" + dataArray[i][j] + "'" + " class='PGY_V'" + '>' + dataArray[i][j] + '</option>'
                            }
                        }
                    }
                    dataResult += '</select>'
                    $('#PGY_name').html(dataResult)
                }
            };
            $('.PGY_V').click(function () {
                var x = []
                x.push($(this).val());
                var rowData = x.value;
                google.script.run.addPGY(rowData);
            });

        })


    </script>

<body>
    <header class="w3-top w3-bar w3-theme">
        <button class="w3-bar-item w3-button w3-xxxsmall w3-hover-theme" onclick="openSidebar()">&#9776;</button>
        <h1 class="w3-bar-item" id="title">教學資源</h1>
    </header>
    <nav class="w3-sidebar w3-bar-block w3-card" id="Sidebar">
        <div class="w3-container w3-theme-d2">
            <span onclick="closeSidebar()" class="w3-button w3-display-topright w3-large">X</span>
        </div>
        <div id="homeBar" class="homeBar">
            <a href="javascript:void(0)" id="page0" class="btn active w3-bar-item w3-button"></a>
            <a href="javascript:void(0)" id="page1" class="btn w3-bar-item w3-button"></a>
            <a href="javascript:void(0)" id="page2" class="btn w3-bar-item w3-button"></a>
            <a href="javascript:void(0)" id="page3" class="btn w3-bar-item w3-button"></a>
            <a href="javascript:void(0)" id="page4" class="btn w3-bar-item w3-button"></a>
            <a href="javascript:void(0)" id="page5" class="btn w3-bar-item w3-button"></a>
            <a href="javascript:void(0)" id="page6" class="btn w3-bar-item w3-button"></a>
            <a href="javascript:void(0)" id="page7" class="btn w3-bar-item w3-button"></a>
            <a href="javascript:void(0)" id="page8" class="btn w3-bar-item w3-button"></a>
            <a href="javascript:void(0)" id="page9" class="btn w3-bar-item w3-button"></a>
        </div>
    </nav>
    <div class="w3-container" style="margin-top:90px">
    </div>
    <div id="_page0" class="page" style="display: block;">
        <table id="data-table_0" class="display compact table-hover table-striped " style="width: 100%; overflow: auto;"></table>
    </div>
    <div id="_page1" class="page">
        <table id="data-table_1" class="display compact table-hover table-striped " style="width: 100%; overflow: auto;"></table>
    </div>
    <div id="_page2" class="page">
        <table id="data-table_2" class="display compact table-hover table-striped " style="width: 100%; overflow: auto;"></table>
    </div>
    <div id="_page3" class="page">
        <table id="data-table_3" class="display compact table-hover table-striped " style="width: 100%; overflow: auto;"></table>
    </div>
    <div id="_page4" class="page">
        <table id="data-table_4" class="display compact table-hover table-striped " style="width: 100%; overflow: auto;"></table>
    </div>
    <div id="_page5" class="page">
        <table id="data-table_5" class="display compact table-hover table-striped " style="width: 100%; overflow: auto;"></table>
    </div>
    <div id="_page6" class="page">
        <table id="data-table_6" class="display compact table-hover table-striped " style="width: 100%; overflow: auto;"></table>
    </div>
    <div id="_page7" class="page">
        <table id="data-table_7" class="display compact table-hover table-striped " style="width: 100%; overflow: auto;"></table>
    </div>
    <div id="_page8" class="page">
        <div>
            <label for="PGY_value">姓名:</label>
            <div id="PGY_name"></div>
            <label for="start">月份:</label>
            <input type="month" id="calendar">
            <div style="overflow: auto;" id="month"></div>
        </div>
    </div>
    <div id="_page9" class="page">
        <div>
            <label for="bookdate">日期:</label>
            <input type="date" id="bookdate">
            <div style="overflow: auto;" id="timetable"></div>
        </div>
    </div>



    <div data-role="popup" id="myPopup" class="ui-content" data-dismissible="false">
        <a href="#" data-rel="back"
            class="ui-btn ui-corner-all ui-shadow ui-btn ui-icon-delete ui-btn-icon-notext ui-btn-right">關閉</a>
        <br>
        <div id="content">
        </div>
    </div>
    <!-- <div>&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;<br></div>
    <footer class="w3-container w3-bottom w3-theme w3-margin-top">
        <h3>藥師教學歷程</h3>
    </footer> -->

</body>