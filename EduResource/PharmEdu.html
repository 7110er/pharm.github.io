<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>藥師教學歷程</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3pro.css">
    <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-teal.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- 連結jquery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- 連結jquery moblie -->
    <link rel="stylesheet" href="https://apps.bdimg.com/libs/jquerymobile/1.4.5/jquery.mobile-1.4.5.min.css">
    <script src="https://apps.bdimg.com/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="https://apps.bdimg.com/libs/jquerymobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <!-- 連結Data table -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.css">
    <link rel="https://cdn.datatables.net/fixedcolumns/4.0.1/css/fixedColumns.dataTables.min.css">
    <script type="text/javascript" charset="utf8"
        src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.js"></script>
    <script src="https://cdn.datatables.net/fixedcolumns/4.0.1/js/dataTables.fixedColumns.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>

    <style>
        .page {
            display: none;
        }

        .active {
            background-color: #eee !important;
            color: black !important;
        }

        .width-60 {
            width: 120px;
        }

        .title {
            background-color: #009688;
            color: white;
            /* width: fit-content; */
        }

        .title1 {
            background-color: #EFEFEF;
            color: black;
            font-weight: bold;
            /* width: fit-content; */
        }
    </style>
    <script>
        $(document).ready(function () {
            google.script.run.withSuccessHandler(sheetName).getName();
            function sheetName(dataArray) {
                for (var i = 0; i < 20; i++) {
                    $('#' + 'page' + i).html(dataArray[i])
                }
            }

            google.script.run.withSuccessHandler(showData).getData();
            function showData(dataArray) {
                for (var i = 0; i < 9; i++) {// 有幾個工作表i就要小於多少
                    $('#' + 'data-table_' + i).DataTable({
                        scrollX: true,
                        scrollY: 800,
                        scrollCollapse: true,
                        data: dataArray[i],
                        columns: [
                            { "title": dataArray[i][0][0] },
                            { "title": dataArray[i][0][1] },
                            { "title": dataArray[i][0][2] },
                        ],
                        "language": {
                            "processing": "處理中...",
                            "loadingRecords": "載入中...",
                            "lengthMenu": "顯示 _MENU_ 項結果",
                            "zeroRecords": "沒有符合的結果",
                            "info": "顯示第 _START_ 至 _END_ 項結果，共 _TOTAL_ 項",
                            "infoEmpty": "顯示第 0 至 0 項結果，共 0 項",
                            "infoFiltered": "(從 _MAX_ 項結果中過濾)",
                            "search": "<i class='fa fa-search'></i>&nbsp;關鍵字搜尋&nbsp;:&nbsp;",
                            "paginate": {
                                "first": "第一頁",
                                "previous": "上一頁",
                                "next": "下一頁",
                                "last": "最後一頁"
                            },
                            "aria": {
                                "sortAscending": ": 升冪排列",
                                "sortDescending": ": 降冪排列"
                            },
                            "emptyTable": "目前沒有資料",
                            "datetime": {
                                "previous": "上一頁",
                                "next": "下一頁",
                                "hours": "時",
                                "minutes": "分",
                                "seconds": "秒",
                                "amPm": [
                                    "上午",
                                    "下午"
                                ]
                            },
                            "searchBuilder": {
                                "add": "新增條件",
                                "condition": "條件",
                                "deleteTitle": "刪除過濾條件",
                                "button": {
                                    "_": "複合查詢 (%d)",
                                    "0": "複合查詢"
                                },
                                "clearAll": "清空",
                                "conditions": {
                                    "array": {
                                        "contains": "含有",
                                        "empty": "為空",
                                        "equals": "等於",
                                        "not": "不為",
                                        "notEmpty": "不為空"
                                    },
                                    "date": {
                                        "after": "大於",
                                        "before": "小於",
                                        "between": "在其中",
                                        "empty": "為空",
                                        "equals": "等於",
                                        "not": "不為",
                                        "notBetween": "不在其中",
                                        "notEmpty": "不為空"
                                    },
                                    "number": {
                                        "between": "在其中",
                                        "empty": "為空",
                                        "equals": "等於",
                                        "gt": "大於",
                                        "gte": "大於等於",
                                        "lt": "小於",
                                        "lte": "小於等於",
                                        "not": "不為",
                                        "notBetween": "不在其中",
                                        "notEmpty": "不為空"
                                    },
                                    "string": {
                                        "contains": "含有",
                                        "empty": "為空",
                                        "endsWith": "字尾為",
                                        "equals": "等於",
                                        "not": "不為",
                                        "notEmpty": "不為空",
                                        "startsWith": "字首為"
                                    }
                                },
                                "data": "欄位",
                                "leftTitle": "群組條件",
                                "logicAnd": "且",
                                "logicOr": "或",
                                "rightTitle": "取消群組",
                                "title": {
                                    "_": "複合查詢 (%d)",
                                    "0": "複合查詢"
                                },
                                "value": "內容"
                            },
                            "editor": {
                                "close": "關閉",
                                "create": {
                                    "button": "新增",
                                    "title": "建立新項目",
                                    "submit": "建立"
                                },
                                "edit": {
                                    "button": "編輯",
                                    "title": "編輯項目",
                                    "submit": "更新"
                                },
                                "remove": {
                                    "button": "刪除",
                                    "title": "刪除",
                                    "submit": "刪除",
                                    "confirm": {
                                        "_": "您確定要刪除 %d 筆資料嗎？",
                                        "1": "您確定要刪除 %d 筆資料嗎？"
                                    }
                                },
                                "multi": {
                                    "restore": "回復修改",
                                    "title": "每行有不同的價值",
                                    "info": "您選擇了多個項目，每項目都有不同的價值。如果您想所有選擇的項目都用同一個價值，可以在這裏輸入一個價值。要不然它們會保留原本各自的價值",
                                    "noMulti": "此列不容許同時編輯多個項目"
                                },
                                "error": {
                                    "system": "系統發生錯誤(更多資訊)"
                                }
                            },
                            "autoFill": {
                                "cancel": "取消"
                            },
                            "buttons": {
                                "copySuccess": {
                                    "_": "複製了 %d 筆資料",
                                    "1": "複製了 1 筆資料"
                                },
                                "copyTitle": "已經複製到剪貼簿",
                                "excel": "Excel",
                                "pdf": "PDF",
                                "print": "列印",
                                "copy": "複製"
                            },
                            "searchPanes": {
                                "collapse": {
                                    "_": "搜尋面版 (%d)",
                                    "0": "搜尋面版"
                                },
                                "emptyPanes": "沒搜尋面版",
                                "loadMessage": "載入搜尋面版中...",
                                "clearMessage": "清空"
                            },
                            "select": {
                                "rows": {
                                    "_": "%d 列已選擇",
                                    "1": "%d 列已選擇"
                                }
                            }
                        }
                        ,
                        columnDefs: [
                            {
                                render: function (data, type, full, meta) {
                                    return "<div class='width-60'>" + data + "</div>";
                                },
                                targets: 1
                            },
                        ],

                    });
                    var table = $('#' + 'data-table_' + i)
                    $(table).DataTable().columns.adjust().draw();
                    $(table).addClass('display wrap compact table-hover table-striped');
                    $(table).DataTable().row(table.children(2).children(1)).remove().draw();

                };
            }

            $('.btn').click(function () {
                var check = $(this).hasClass('active');
                var then = "_" + this.id
                if (!check) {
                    $(this).toggleClass('active');
                    $('.homeBar a').not(this).removeClass('active');
                    $('#' + then).toggle();
                    $('table').DataTable().columns.adjust().draw();
                    $(".page:visible").not('#' + then).hide();
                };
                $('#title').html(this.textContent);
                closeSidebar();
            });
            closeSidebar();

            google.script.run.withSuccessHandler(showData_3).getData2();
            function showData_3(dataArray) {
                if (dataArray !== undefined && dataArray.length != 0) {
                    var dataResult = '<select name="PGY_value" id="PGY_value">'
                    for (var i = 0; i < 1; i++) {
                        for (var j = 0; j < dataArray[i].length; j++) {
                            if (dataArray[i][j] !== undefined && dataArray[i][j] !== '') {
                                dataResult += '<option value=' + "'" + dataArray[i][j] + "'" + " class='PGY_V'" + '>' + dataArray[i][j] + '</option>'
                            }
                        }
                    }
                    dataResult += '</select>'
                    $('#PGY_name').html(dataResult)
                }
            };

            $('#bookdate').change(function () {//日期選擇自動填入試算表
                var date = document.getElementById('bookdate');
                var rowData = date.value;
                google.script.run.addDate(rowData);
                google.script.run.withSuccessHandler(Showdata_1).getData1();//創造表格
                function Showdata_1(dataArray) {
                    if (dataArray !== undefined && dataArray.length != 0) {
                        var dataResult = "<table class='table table-sm table-striped' width='100%' data-dismissible='false' >" +
                            "<thead style='white-space: nowrap'>"
                        for (var i = 0; i < 1; i++) {
                            for (var j = 0; j < 1; j++) {
                                dataResult += "<tr class='title'>" + "<td>" + dataArray[i][j] + "</td>"
                            }
                            for (var j = 1; j < 16; j++) {
                                dataResult += "<td>" + dataArray[i][j] + "</td>"
                            }
                            for (var j = 16; j < 17; j++) {
                                dataResult += "<td>" + dataArray[i][j] + "</td>" + "</tr>"
                            }
                        }
                        for (var i = 1; i < 14; i++) {
                            for (var j = 0; j < 1; j++) {
                                dataResult += "<tr>" + "<td class='title1'>" + dataArray[i][j] + "</td>"
                            }
                            for (var j = 1; j < 16; j++) {
                                dataResult += "<td>" + dataArray[i][j] + "</td>"
                            }
                            for (var j = 16; j < 17; j++) {
                                dataResult += "<td>" + dataArray[i][j] + "</td>" + "</tr>"
                            }
                        }
                        dataResult += "</thead>" + "</table>"

                        $('#timetable').html(dataResult)

                    }
                }
            })

        })
        function getVal(data) {
            var text = $(data).parent().next().text()
            var index = $(data).closest('table').attr('id')  // 取得所在table的id名稱ex:data-table_1
            var e = parseInt(index.slice(11))
            // 宣告變數e將data-table_1轉為1(數字)，當google script上searchData的第二個參數，
            // 讓他可以搜尋按鈕所在的工作表位置，否則所有按鈕都執行getVal這function卻不知道要去哪個工作表內找資料
            google.script.run.withSuccessHandler(showData_2).searchData(text, e);
        }
        function getVal1(data) {
            var text = $(data).parent().next().text()
            google.script.run.withSuccessHandler(showData_2).searchData1(text);
        }
        function showData_2(array) {
            if (array !== undefined && array.length != 0) {
                var dataResult = "<table class='table table-sm table-striped' width='100%' style='table-layout:fixed'>" +
                    "<thead style='white-space: normal'>"
                for (var i = 0; i < 1; i++) {
                    for (var j = 0; j < array[i].length - 1; j++) {
                        if (array[i + 1][j + 1] != undefined && array[i + 1][j + 1] !== "") {
                            dataResult += "<tr>" + "<td class = 'title'>" + array[i][j] + "</td>" + "<td>" + array[i + 1][j + 1] + "</td>" + "</tr>"
                        }
                    }
                }
                dataResult += "</thead>" + "</table>"

                $('#content').html(dataResult)
            }
        }
        function openSidebar() {
            document.getElementById("Sidebar").style.display = "block";
        }
        function closeSidebar() {
            document.getElementById("Sidebar").style.display = "none";
        }
        function submitPGY() {
            var PGY = document.getElementById('PGY_value');
            var month = document.getElementById('calendar');
            var rowData = {
                PGY: PGY.value,
                month: month.value
            };
            google.script.run.addPGY(rowData);
            google.script.run.withSuccessHandler(showdata_4).getData3();
            function showdata_4(dataArray) {
                if (dataArray !== undefined && dataArray.length != 0) {
                    var dataResult = "<table class='table table-sm table-striped' width='100%' data-dismissible='false' >" +
                        "<thead style='white-space: nowrap'>"
                    for (var i = 0; i < 1; i++) {
                        for (var j = 0; j < dataArray[i].length; j++) {
                            dataResult += "<tr>" + "<td class='title'>" + dataArray[i][j] + "</td>" + "<td>" + dataArray[i + 1][j] + "</td>" + "</tr>"
                        }
                    }
                    dataResult += "</thead>" + "</table>"

                    $('#month').html(dataResult)
                }

            }
        }
        function subpub() {
            var date = document.getElementById('date1');
            var group = document.getElementById('group');
            var category = document.getElementById('category');
            var publisher = document.getElementById('publisher');
            var subject = document.getElementById('subject');
            var img = document.getElementById('img');
            var link1 = document.getElementById('link1');
            var link2 = document.getElementById('link2');
            var link3 = document.getElementById('link3');
            var rowData = {
                date: date.value,
                group: group.value,
                category: category.value,
                publisher: publisher.value,
                subject: subject.value,
                img: img.value,
                link1: link1.value,
                link2: link2.value,
                link3: link3.value,
            };
            google.script.run.addPub(rowData);
            alert('公告已送出')
        }

        function LoadFile(event) {
            var file = event.target.files[0];
            var reader = new FileReader();
            reader.onload = function (e) {
                // console.log(e.target.result);
                var fileData = e.target.result.substr(e.target.result.indexOf(",") + 1);
                var mimeTypeStart = e.target.result.indexOf("data:") + 5;
                var mimeTypeEnd = e.target.result.indexOf(";");
                var mimeType = e.target.result.substr(mimeTypeStart, mimeTypeEnd - mimeTypeStart);
                var fileName = file.name;
                document.getElementById("fileData").value = fileData;
                document.getElementById("mimeType").value = mimeType;
                document.getElementById("fileName").value = fileName;
            };
            reader.readAsDataURL(file);
        }
    </script>

<body>
    <header class="w3-top w3-bar w3-theme">
        <button class="w3-bar-item w3-button w3-xxxsmall w3-hover-theme" onclick="openSidebar()">&#9776;</button>
        <h1 class="w3-bar-item" id="title">教學資源</h1>
    </header>
    <nav class="w3-sidebar w3-bar-block w3-card" id="Sidebar">
        <div class="w3-container w3-theme-d2">
            <span onclick="closeSidebar()" class="w3-button w3-display-topright w3-large">X</span>
        </div>
        <div id="homeBar" class="homeBar">
            <a href="javascript:void(0)" id="page0" class="btn active w3-bar-item w3-button"></a>
            <a href="javascript:void(0)" id="page1" class="btn w3-bar-item w3-button"></a>
            <a href="javascript:void(0)" id="page2" class="btn w3-bar-item w3-button"></a>
            <a href="javascript:void(0)" id="page3" class="btn w3-bar-item w3-button"></a>
            <a href="javascript:void(0)" id="page4" class="btn w3-bar-item w3-button"></a>
            <a href="javascript:void(0)" id="page5" class="btn w3-bar-item w3-button"></a>
            <a href="javascript:void(0)" id="page6" class="btn w3-bar-item w3-button"></a>
            <a href="javascript:void(0)" id="page7" class="btn w3-bar-item w3-button"></a>
            <a href="javascript:void(0)" id="page8" class="btn w3-bar-item w3-button"></a>
            <a href="javascript:void(0)" id="page9" class="btn w3-bar-item w3-button"></a>
            <a href="javascript:void(0)" id="page10" class="btn w3-bar-item w3-button"></a>
            <a href="javascript:void(0)" id="page11" class="btn w3-bar-item w3-button"></a>
        </div>
    </nav>
    <div class="w3-container" style="margin-top:90px">
    </div>
    <div id="_page0" class="page" style="display: block;">
        <table id="data-table_0" class="display compact table-hover table-striped "
            style="width: 100%; overflow: auto;"></table>
    </div>
    <div id="_page1" class="page">
        <table id="data-table_1" class="display compact table-hover table-striped "
            style="width: 100%; overflow: auto;"></table>
    </div>
    <div id="_page2" class="page">
        <table id="data-table_2" class="display compact table-hover table-striped "
            style="width: 100%; overflow: auto;"></table>
    </div>
    <div id="_page3" class="page">
        <table id="data-table_3" class="display compact table-hover table-striped "
            style="width: 100%; overflow: auto;"></table>
    </div>
    <div id="_page4" class="page">
        <table id="data-table_4" class="display compact table-hover table-striped "
            style="width: 100%; overflow: auto;"></table>
    </div>
    <div id="_page5" class="page">
        <table id="data-table_5" class="display compact table-hover table-striped "
            style="width: 100%; overflow: auto;"></table>
    </div>
    <div id="_page6" class="page">
        <table id="data-table_6" class="display compact table-hover table-striped "
            style="width: 100%; overflow: auto;"></table>
    </div>
    <div id="_page7" class="page">
        <table id="data-table_7" class="display compact table-hover table-striped "
            style="width: 100%; overflow: auto;"></table>
    </div>
    <div id="_page8" class="page">
        <table id="data-table_8" class="display compact table-hover table-striped "
            style="width: 100%; overflow: auto;"></table>
    </div>
    <div id="_page9" class="page">
        <div>
            <label for="PGY_value">姓名:</label>
            <div id="PGY_name"></div>
            <label for="calendar">月份:</label>
            <input type="month" id="calendar" name="calendar">
            <button type="button" onclick="submitPGY()">送出</button>
            <div style="overflow: auto;" id="month"></div>
        </div>
    </div>
    <div id="_page10" class="page">
        <div>
            <label for="bookdate">日期:</label>
            <input type="date" id="bookdate">
            <div style="overflow: auto;" id="timetable"></div>
        </div>
    </div>
    <div id="_page11" class="page">
        <form action="/action_page.php" method="post">
            <label for="date1">日期</label>
            <input type="date" id="date1" name="date1">

            <label for="group">組別</label>
            <select id="group" name="group">
                <option value="門診組">門診組</option>
                <option value="急診組">急診組</option>
                <option value="住院組">住院組</option>
                <option value="藥庫組">藥庫組</option>
                <option value="中藥組">中藥組</option>
                <option value="特調組">特調組</option>
                <option value="行政組">行政組</option>
                <option value="臨床組">臨床組</option>
                <option value="教學組">教學組</option>
                <option value="主任">主任</option>
            </select>

            <label for="category">公告類別</label>
            <select id="category" name="category">
                <option value="藥品調劑">藥品調劑</option>
                <option value="藥品管理">藥品管理</option>
                <option value="臨床藥事服務">臨床藥事服務</option>
                <option value="藥品諮詢">藥品諮詢</option>
            </select>

            <label for="publisher">發布者</label>
            <input type="text" id="publisher" placeholder="請填姓名" name="publisher">

            <label for="subject">公告內容</label>
            <textarea id="subject" name="subject" placeholder="此處填寫..." style="height:200px"></textarea>

            <label for="file">圖片上傳(按住ctrl可選擇多圖)</label>
            <?var url =getURL();?>
            <form method="post " action="<?= url ?>">
                <input name="file" type="file" accept="image/gif, image/jpeg, image/png" id="img" multiple
                    onchange="LoadFile(event)">
                <input type="hidden" id="fileData" name="fileData">
                <input type="hidden" id="mimeType" name="mimeType">
                <input type="hidden" id="fileName" name="fileName">

                <!-- 上傳後的訊息 -->
                <h3>上傳結果:<span>
                        <?= message ?>
                    </span></h3>
            </form>

            <label for="link">連結上傳1</label>
            <input type="text" name="link" placeholder="放入連結" id="link1">
            <label for="link">連結上傳2</label>
            <input type="text" name="link" placeholder="放入連結" id="link2">
            <label for="link">連結上傳3</label>
            <input type="text" name="link" placeholder="放入連結" id="link3">

            <input type="submit" value="發布" onclick="subpub()">
        </form>
    </div>


    <div data-role="popup" id="myPopup" class="ui-content" data-dismissible="false">
        <a href="#" data-rel="back"
            class="ui-btn ui-corner-all ui-shadow ui-btn ui-icon-delete ui-btn-icon-notext ui-btn-right">關閉</a>
        <br>
        <div id="content">
        </div>
    </div>

</body>