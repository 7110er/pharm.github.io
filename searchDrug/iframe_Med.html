<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="高順鴻">
    <title>藥品查詢</title>
    <!-- 連結jquery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- 連結jquery moblie -->

    <link rel="stylesheet" href="https://apps.bdimg.com/libs/jquerymobile/1.4.5/jquery.mobile-1.4.5.min.css">
    <script src="https://apps.bdimg.com/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="https://apps.bdimg.com/libs/jquerymobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    
        <!-- 連結Data table -->

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.css">
  
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.js"></script>
    <!-- Rwd js -->
    <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>

    <!-- Rwd css -->
    <link rel="stylesheet"  href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css">
    <link rel="stylesheet"  href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.dataTables.min.css">
    

    <style>
        #dtable td, #dtable th{
            border: 1px solid #ddd;
            padding: 5px;
            
        }
    </style>
    <!-- 程式碼開始 -->
    <script>

        google.script.run.withSuccessHandler(showData).getData();
          
          function showData(dataArray){
          $(document).ready(function(){
            $('#data-table').DataTable({
                scrollY:500,
                scrollX:true,
                scrollCollapse:true,
                paging:false,
                
                "language":{
                    // 表格翻譯成中文
                    "processing": "處理中...",
                    "loadingRecords": "載入中...",
                    "lengthMenu": "顯示 _MENU_ 項結果",
                    "zeroRecords": "沒有符合的結果",
                    "info": "顯示第 _START_ 至 _END_ 項結果，共 _TOTAL_ 項",
                    "infoEmpty": "顯示第 0 至 0 項結果，共 0 項",
                    "infoFiltered": "(從 _MAX_ 項結果中過濾)",
                    "search": "請輸入藥品關鍵字:",
                    "paginate": {
                        "first": "第一頁",
                        "previous": "上一頁",
                        "next": "下一頁",
                        "last": "最後一頁"
                    },
                    "aria": {
                        "sortAscending": ": 升冪排列",
                        "sortDescending": ": 降冪排列"
                    },
                    "emptyTable": "目前沒有資料",
                    "datetime": {
                        "previous": "上一頁",
                        "next": "下一頁",
                        "hours": "時",
                        "minutes": "分",
                        "seconds": "秒",
                        "amPm": [
                            "上午",
                            "下午"
                        ]
                    },
                    "searchBuilder": {
                        "add": "新增條件",
                        "condition": "條件",
                        "deleteTitle": "刪除過濾條件",
                        "button": {
                            "_": "複合查詢 (%d)",
                            "0": "複合查詢"
                        },
                        "clearAll": "清空",
                        "conditions": {
                            "array": {
                                "contains": "含有",
                                "empty": "為空",
                                "equals": "等於",
                                "not": "不為",
                                "notEmpty": "不為空"
                            },
                            "date": {
                                "after": "大於",
                                "before": "小於",
                                "between": "在其中",
                                "empty": "為空",
                                "equals": "等於",
                                "not": "不為",
                                "notBetween": "不在其中",
                                "notEmpty": "不為空"
                            },
                            "number": {
                                "between": "在其中",
                                "empty": "為空",
                                "equals": "等於",
                                "gt": "大於",
                                "gte": "大於等於",
                                "lt": "小於",
                                "lte": "小於等於",
                                "not": "不為",
                                "notBetween": "不在其中",
                                "notEmpty": "不為空"
                            },
                            "string": {
                                "contains": "含有",
                                "empty": "為空",
                                "endsWith": "字尾為",
                                "equals": "等於",
                                "not": "不為",
                                "notEmpty": "不為空",
                                "startsWith": "字首為"
                            }
                        },
                        "data": "欄位",
                        "leftTitle": "群組條件",
                        "logicAnd": "且",
                        "logicOr": "或",
                        "rightTitle": "取消群組",
                        "title": {
                            "_": "複合查詢 (%d)",
                            "0": "複合查詢"
                        },
                        "value": "內容"
                    },
                    "editor": {
                        "close": "關閉",
                        "create": {
                            "button": "新增",
                            "title": "建立新項目",
                            "submit": "建立"
                        },
                        "edit": {
                            "button": "編輯",
                            "title": "編輯項目",
                            "submit": "更新"
                        },
                        "remove": {
                            "button": "刪除",
                            "title": "刪除",
                            "submit": "刪除",
                            "confirm": {
                                "_": "您確定要刪除 %d 筆資料嗎？",
                                "1": "您確定要刪除 %d 筆資料嗎？"
                            }
                        },
                        "multi": {
                            "restore": "回復修改",
                            "title": "每行有不同的價值",
                            "info": "您選擇了多個項目，每項目都有不同的價值。如果您想所有選擇的項目都用同一個價值，可以在這裏輸入一個價值。要不然它們會保留原本各自的價值",
                            "noMulti": "此列不容許同時編輯多個項目"
                        },
                        "error": {
                            "system": "系統發生錯誤(更多資訊)"
                        }
                    },
                    "autoFill": {
                        "cancel": "取消"
                    },
                    "buttons": {
                        "copySuccess": {
                            "_": "複製了 %d 筆資料",
                            "1": "複製了 1 筆資料"
                        },
                        "copyTitle": "已經複製到剪貼簿",
                        "excel": "Excel",
                        "pdf": "PDF",
                        "print": "列印",
                        "copy": "複製"
                    },
                    "searchPanes": {
                        "collapse": {
                            "_": "搜尋面版 (%d)",
                            "0": "搜尋面版"
                        },
                        "emptyPanes": "沒搜尋面版",
                        "loadMessage": "載入搜尋面版中...",
                        "clearMessage": "清空"
                    },
                    "select": {
                        "rows": {
                            "_": "%d 列已選擇",
                            "1": "%d 列已選擇"
                        }
                    }
                },
              data: dataArray,
            
              columns: [
                {"title":"詳閱" },
                {"title":"中文名"},
                {"title":"英文名"},
                {"title":"處置代碼"},
                {"title":"主成分"},            
            
              ],
            });
          });
        }
        //  避免表單有空白的錯誤
        function preventFormSubmit() {
            var forms = document.querySelectorAll('form');
            for (var i = 0; i < forms.length; i++) {
                forms[i].addEventListener('submit', function(event) {
                    event.preventDefault();
                });
            }

        }
        window.addEventListener("load", preventFormSubmit, true);
        // 顯示表格內容

        function createTable(dataArray) {
            if (dataArray && dataArray !== undefined && dataArray.length != 0) {

                var result1 = "<table class='table table-sm table-striped' id='dtable' style='font-size:16px'>" +
                    "<thead style='white-space: normal'>" +

                    "<tr>" 
                    for (var i = 0; i < dataArray.length; i++) {
                        for (var j = 0; j < 1; j++) {
                            result1 +="<th scope='col' style='width:90px' >主成分</th>"+"<td>" + dataArray[i][j] + "</td>";
                    }
                }
                    result1+=
                    "</tr>" + 
                    "<tr>" + 
                    "<th scope='col' style='width:90px '>英文名</th>" 
                    for (var i = 0; i < dataArray.length; i++) {
                        for (var j = 1; j < 2; j++) {
                        result1 += "<td>" + dataArray[i][j] + "</td>";
                    }
                }
                document.getElementById('drugName').innerHTML=result1;
                    result1+=
                    "</tr>" + 
                    "<tr>" + 
                    "<th scope='col'style='width:90px'>處置代碼</th>" 
                    for (var i = 0; i < dataArray.length; i++) {
                        for (var j = 2; j < 3; j++) {
                        result1 += "<td>" + dataArray[i][j] + "</td>";
                    }
                }
                    result1+=
                    "</tr>" + 
                    "<tr>" 
                    for (var i = 0; i < dataArray.length; i++) {
                        for (var j = 3; j < 4; j++) {
                            if(dataArray[i][j]==''){
                                result1+='';
                            }
                            else{
                                result1 +="<th scope='col' style='width:90px' >中文名</th>"+"<td >" +  dataArray[i][j] + "</td>";
                            }
                    }
                }
                    result1+=
                    "</tr>" +
                    "<tr>"
                    for (var i = 0; i < dataArray.length; i++) {
                        for (var j = 4; j < 5; j++) {
                            if(dataArray[i][j]==''){
                                result1+='';
                            }
                            else{
                                result1 +="<th scope='col' style='width:90px' >適應症</th>"+"<td >" + dataArray[i][j] + "</td>";
                            }
                    }
                }
                    result1+=
                    "</tr>"+
                    "<tr>"
                    for (var i = 0; i < dataArray.length; i++) {
                        for (var j = 5; j < 6; j++) {
                            if(dataArray[i][j]==''){
                                result1+='';
                            }
                            else{
                                result1 +="<th scope='col' style='width:90px' >生理學</th>"+"<td >" + dataArray[i][j] + "</td>";
                            }
                    }
                }
                    result1+=
                    "</tr>"+
                    "<tr>"
                    for (var i = 0; i < dataArray.length; i++) {
                        for (var j = 6; j < 7; j++) {
                            if(dataArray[i][j]==''){
                                result1+='';
                            }
                            else{
                                result1 +="<th scope='col' style='width:90px' >劑量學</th>"+"<td >" + dataArray[i][j] + "</td>";
                            }
                    }
                }
                    result1+=
                    "</tr>"+
                    "<tr>"
                    for (var i = 0; i < dataArray.length; i++) {
                        for (var j = 7; j < 8; j++) {
                            if(dataArray[i][j]==''){
                                result1+='';
                            }
                            else{
                                result1 +="<th scope='col' style='width:90px' >副作用</th>"+"<td >" + dataArray[i][j] + "</td>";
                            }
                    }
                }
                    result1+=
                    "</tr>"+
                    "<tr>"
                    for (var i = 0; i < dataArray.length; i++) {
                        for (var j = 8; j < 9; j++) {
                            if(dataArray[i][j]==''){
                                result1+='';
                            }
                            else{
                                result1 +="<th scope='col' style='width:90px' >警語</th>"+"<td >" + dataArray[i][j] + "</td>";
                            }
                    }
                }
                    result1+=
                    "</tr>"+
                    "<tr>"
                    for (var i = 0; i < dataArray.length; i++) {
                        for (var j = 9; j < 10; j++) {
                            if(dataArray[i][j]==''){
                                result1+='';
                            }
                            else{
                                result1 +="<th scope='col' style='width:90px' >交互作用</th>"+"<td >" + dataArray[i][j] + "</td>";
                            }
                    }
                }
                    result1+=
                    "</tr>"+
                    "<tr style='height:500px'>"
                    for (var i = 0; i < dataArray.length; i++) {
                        for (var j = 10; j < 11; j++) {
                            if(dataArray[i][j]==''){
                                result1+='';
                            }
                            else{
                                result1 += " <th scope='col' style='width:90px' >仿單</th>"+"<td ><embed src='https://7110er.github.io/pharm.github.io/searchDrug/321/test_1.pdf' type='application/pdf' style='height:500px'></td>"
                            }
                    }
                }
                    result1+=
                    "</tr>"+

                    "</thead>"+
                    "</table>";
                
                

                var div = document.getElementById('result');
                div.innerHTML = result1;
                
            } 

            else {

                var div = document.getElementById('result');
                div.innerHTML = "沒有找到相關藥物，請重新輸入。";
            }
        }


        // 判斷string 是否為網址
        function isURL(string) {
            let url;
            
            try {
                url = new URL(string);
            } catch (_) {
                return false;  
            }

            return url.protocol === "http:" || url.protocol === "https:";
        }
        // 連結Google Script　並且顯示資料

        function searchGoogleSheet(divElement){
            var searchText = $(divElement).parent().next().next().text();
            google.script.run.withSuccessHandler(createTable).search(searchText);
        }
        // 問題回報
        function getValue(){
            var name=document.getElementById('text');
            var phone=document.getElementById('phone');
            var comments=document.getElementById('comments');
            var drugName=document.getElementById('drugName').innerText;
            var rowData={
                name:name.value,
                phone:phone.value,
                comments:comments.value,
                drugName:drugName
            }
        
        google.script.run.addData(rowData);
        
        document.getElementById('report').hidden=true;
        document.getElementById('response').hidden=false;

    };

        function formReset(){
            document.getElementById('report').reset();
            document.getElementById('report').hidden=false;
            document.getElementById('response').hidden=true;
        }
</script>
</head>

<body>
    <!-- jq mobile 測試 -->
    <div data-role="page" id="pageone" data-theme="a" >
        <div data-role="header">
            
        </div>
        <div data-role="main" >
                <!--搜尋表單  -->
                <div class="container">
                    <br>
                        <div class="row">
                            <table id="data-table" class="display compact table-hover table-striped  responsive " >
                            <!-- TABLE DATA IS ADDED BY THE showData() JAVASCRIPT FUNCTION ABOVE -->
                            </table>
                        </div>
                </div>
        </div>
        <div data-role="footer">
            <h1 ><b>藥品查詢系統</b></h1>
        </div>
  
      
    </div> 
    <div data-role="page" id="pagetwo" data-theme="a">
        <div data-role="header">
            <div data-role="navbar">
                <ul>
                  <li><a href="#pageone" class="ui-btn ui-icon-arrow-l ui-btn-icon-left" id="other-color">上一頁</a></li>
                  <li><a href="#myPopup" data-rel="popup" id="other-color">聯絡我們</a></li>
                  <li><a href="#" id="other-color">更多資訊</a></li>
                </ul>
            </div>
        </div>
        <div data-role="main" >
             <p id="result" style="overflow: auto;"></p>
                <!-- 問題回報視窗 -->
                <div data-role="popup" id="myPopup" class="ui-content" data-dismissible="false">
                    <a href="#" data-rel="back" onclick='formReset()'class="ui-btn ui-corner-all ui-shadow ui-btn ui-icon-delete ui-btn-icon-notext ui-btn-right">關閉</a>
                    <br>
                    <div id="drugName">

                    </div>
                    <br>
                    <form id="report">
                        <label for="comments">意見與回饋</label>
                        <textarea class="form-control" id="comments"  rows="5"></textarea>
                        <label for="text">請輸入您的姓名 : </label>
                        <input type="text" id="text" placeholder="ex:王先生">
                        <label for="phone">您的聯絡方式 : </label>
                        <input type="number" id="phone" placeholder="ex:0912345678">
                        <button type="submit" onclick='getValue()' class="ui-btn ui-btn-inline ui-icon-check ui-btn-icon-right ui-corner-all ui-shadow ui-alt-icon">送出</button>
                    </form>

                    <div id="response" style="font-size: large; color: rgb(19, 0, 128); text-align: center; font-weight: bold;" hidden>
                        感謝您的意見與回饋!!
                        <br>
                        我們將於上班時間盡快回覆!!
                    </div>
                </div>
        </div>

        <div data-role="footer">
            <h1 ><b>藥品查詢結果</b></h1>
        </div>


    </div>

</body>

</html>
