<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="高順鴻">
    <title>表單</title>

    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css">
    <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script> -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8"
        src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.js"></script>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            margin: 0;
        }
        .active {
            background-color: #eee;
            color: black;
        }
        .container input {
            padding: 10px;
        }
        #checkbox{
            /* display: none; */
        }
        .radioTd1, .radioTd2{
            width: 20%;
        }
        .quizTd1, .quizTd2 {
            width: 80%;
        }
        form {
            width: 100%;
        }
    </style>
    <script>
        function searchGoogleSheet_1() {
            google.script.run.withSuccessHandler(createTable_1).search_1();
        }
        function searchGoogleSheet_2(e, index) {
            google.script.run.withSuccessHandler(createTable_2).search_2(e);
            function createTable_2(dataArray) {
                if (dataArray !== undefined && dataArray.length != 0) {
                    var dataResult = "<table class='table table-sm table-striped' style='border-collapse: separate'; id='dtable' >" +
                        "<thead >"
                    for (var i = 0; i < dataArray.length; i++) {
                        for (var j = 1; j < 4; j++)
                            dataResult += "<tr>" + "<td class='quizTd2'>" + dataArray[i][j] + "</td>" + "<td class='radioTd2'>" +
                                "<label class='container'>" + "是" + "<input class='radioInput' type='radio'  value='是' name='radio" + index + [j] + "'>" + "</label>" +
                                "<label class='container'>" + "否" + "<input class='radioInput'  type='radio' checked='checked' value='否' name='radio" + index + [j] + "'>" + "</label>" +
                                "</td>" + "</tr>";
                    }

                    dataResult +=
                        "</thead>" +
                        "</table>";
                    var div = document.getElementById('result2');
                    div.innerHTML += dataResult;
                }
            }

        }
        function createTable_1(dataArray) {
            if (dataArray !== undefined && dataArray.length != 0) {
                var dataResult = "<table class='table table-sm table-striped' style='border-collapse: separate'; id='dtable' >" +
                    "<thead >"
                for (var i = 0; i < dataArray.length; i++) {
                    dataResult += "<tr>" + "<td class='quizTd1'>" + dataArray[i] + "</td>" + "<td class='radioTd1'>" +
                        "<label class='container'>" + "1" + "<input type='radio'  value='1' name='radio" + [i] + "'>" + "</label>" +
                        "<label class='container'>" + "2" + "<input type='radio'  value='2' name='radio" + [i] + "'>" + "</label>" +
                        "<label class='container'>" + "3" + "<input type='radio'  value='3' name='radio" + [i] + "'>" + "</label>" +
                        "<label class='container'>" + "4" + "<input type='radio'  value='4' name='radio" + [i] + "'>" + "</label>" +
                        "</td>" + "</tr>";
                }
                dataResult +=
                    "</thead>" +
                    "</table>";
                var div = document.getElementById('result1');
                div.innerHTML = dataResult;
            }
        }
        function submit2() {
            var id = document.getElementById('id');
            var name = document.getElementById('name');
            var age = document.getElementById('age');
            var x = document.getElementsByClassName('quizTd2');
            var z = [];
            for (var i = 0; i < x.length; i++) {
                z.push(x[i].textContent);
            }
            var y = [];
            $(':radio:checked').each(function () {
                y.push($(this).val());
            })
            var w = [];
            for (var i = 0; i < y.length; i++) {
                w.push(z[i]);
                w.push(y[i]);
            }
            var rowData = {
                id: id.value,
                name: name.value,
                age: age.value,
                dataResult: w,
            }
            google.script.run.addData(rowData);
            document.getElementById('result2').reset();
            document.getElementById('basic').reset();
        }
        function getSum() {
            dataLength = document.querySelectorAll(".radioTd1").length;
            var formResult = [];
            let sum = 0;
            for (var i = 0; i < dataLength; i++) {
                formResult[i] = document.querySelector("input[name='radio" + [i] + "']" + ":checked").value;
                sum += +(formResult[i])
            };
            document.getElementById('sum').innerHTML = '總分 : ' + sum + ' 分';
        }
        function getCheckValue() {
            var array = []
            var checkboxes = document.querySelectorAll('input[type=checkbox]:checked')
            for (var i = 0; i < checkboxes.length; i++) {
                array.push(checkboxes[i].value)
            }
            array.forEach(searchGoogleSheet_2);
        }
        function submit1(){
            var id = document.getElementById('id');
            var name = document.getElementById('name');
            var age = document.getElementById('age');
            dataLength = document.querySelectorAll(".radioTd1").length;
            var formResult = [];
            for (var i = 0; i < dataLength; i++) {
                if ($("input[name='radio" + [i] + "']").is(':checked')){
                    formResult[i] = document.querySelector("input[name='radio" + [i] + "']" + ":checked").value;
                }else{
                    formResult[i]='沒資料';
                }                
            };
            console.log(formResult);
            var rowData = {
                id: id.value,
                name: name.value,
                age: age.value,
                dataResult: formResult
            }
            google.script.run.addData(rowData);
            document.getElementById('result1').reset();
            document.getElementById('result1').style.display='none';
            document.getElementById('checkbox').style.display='block';

        }
    </script>
</head>

<body>
    <button class="subDrugBtn active">建檔</button>
    <button class="subDrugBtn">查詢</button>

    <form id="basic">
        <label for="id">病歷號 : </label><input id="id" type="number" placeholder="輸入病歷號">
        <label for="name">姓名 : </label><input id="name" type="text" placeholder="ex:王*明">
        <label for="age">年齡 : </label><input id="age" type="number" placeholder="年齡">
    </form>
    <button onclick="searchGoogleSheet_1()">服藥配合度</button>
    <button onclick="submit1()">配合度送出</button>   
    <button onclick="getSum()">總分</button>

    <button onclick="getCheckValue()">產生表單</button>
    <button onclick="submit2()">表單送出</button>
    <div>
        <form id="result1"></form>
        <form id="result2"></form>
        <p id="sum"></p>
    </div>
    <div id="checkbox">
        <label class='container'for="htn">高血壓<input id="htn" type='checkbox' value="高血壓"></label>
        <label class='container' for="hf">心衰竭<input id="hf"  type='checkbox' value="心衰竭"></label>
        <label class='container' for="cad">冠心症<input id="cad"  type='checkbox' value="冠心症"></label>
        <label class='container' for="af">心律不整<input id="af"  type='checkbox' value="心律不整"></label>
        <label class='container' for="dm">糖尿病<input id="dm"  type='checkbox' value="糖尿病"></label>


    </div>
</body>

</html>